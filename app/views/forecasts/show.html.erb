<div class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-sky-100 to-blue-200 py-8">
  <div class="w-full max-w-md bg-white/90 rounded-xl shadow-lg p-8">
    <% data = @forecast.data.with_indifferent_access %>
    <% current = data[:currently] || {} %>
    <% daily = data[:daily] && data[:daily][:data] ? data[:daily][:data] : [] %>
    <div class="mb-2 flex justify-between items-center">
      <div class="text-blue-900 font-bold text-xl">
        <%= data.dig(:timezone) %>
      </div>
      <% if @from_cache %>
        <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded" title="Result from cache">Cached</span>
      <% end %>
    </div>
    <div class="text-blue-700 text-sm mb-4">
      <%= Time.at(current[:time] || daily.first&.dig(:time) || Time.now.to_i).in_time_zone(data[:timezone] || 'UTC').strftime('%A, %B %e, %l:%M %p') rescue '' %>
    </div>
    <div class="flex items-center justify-between mb-4">
      <div>
        <div class="text-6xl font-extrabold text-blue-800">
          <%= current[:temperature].round if current[:temperature] %>째F
        </div>
        <div class="text-blue-700 text-lg">
          <%= current[:summary] %>
        </div>
      </div>
      <%# Pirate Weather does not provide icons as URLs, but as icon names %>
      <% if current[:icon] %>
        <img src="https://raw.githubusercontent.com/manifestinteractive/weather-underground-icons/master/dist/icons/white/png/64x64/<%= current[:icon] %>.png" alt="Weather icon" class="w-20 h-20">
      <% end %>
    </div>
    <% if daily.present? %>
      <div class="flex justify-between mb-4">
        <div class="text-blue-700">
          <span class="font-semibold">High:</span> <%= daily.first[:temperatureHigh].round if daily.first && daily.first[:temperatureHigh] %>째F
        </div>
        <div class="text-blue-700">
          <span class="font-semibold">Low:</span> <%= daily.first[:temperatureLow].round if daily.first && daily.first[:temperatureLow] %>째F
        </div>
      </div>
      <div class="mb-6">
        <div class="font-semibold text-blue-900 mb-2">3-Day Forecast</div>
        <div class="grid grid-cols-3 gap-2">
          <% daily.first(3).each do |day| %>
            <div class="bg-blue-50 rounded p-2 flex flex-col items-center">
              <div class="text-xs text-blue-700 mb-1"><%= Time.at(day[:time]).in_time_zone(data[:timezone] || 'UTC').strftime('%a') rescue '' %></div>
              <% if day[:icon] %>
                <img src="https://raw.githubusercontent.com/manifestinteractive/weather-underground-icons/master/dist/icons/white/png/32x32/<%= day[:icon] %>.png" alt="icon" class="w-8 h-8 mb-1">
              <% end %>
              <div class="text-sm text-blue-800 font-bold"><%= day[:temperatureHigh].round if day[:temperatureHigh] %>째F</div>
              <div class="text-xs text-blue-600"><%= day[:summary] %></div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <div class="flex justify-between items-center">
      <%= button_to 'Refresh', forecast_path(@forecast, refresh: true), method: :post, class: "py-2 px-4 rounded bg-blue-500 hover:bg-blue-700 text-white font-bold text-sm transition" %>
      <%= link_to 'New Search', forecasts_path, class: "py-2 px-4 rounded bg-gray-100 hover:bg-gray-200 text-blue-700 font-semibold text-sm" %>
    </div>
  </div>
</div>
